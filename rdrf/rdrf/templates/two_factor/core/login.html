{% extends "two_factor/_base_focus.html" %}

{% load i18n static two_factor %}

{% block content %}
  <form action="" method="post">
    {% csrf_token %}

      <div class="card card-default">
        <div class="card-header">{% trans "Login" %}</div>
        <div class="card-body">
          <div class="row">
            <div class="col-xs-12 text-center">
              {% if wizard.steps.current == 'auth' %}
                {% blocktrans %}Please enter your credentials.{% endblocktrans %}
              {% elif wizard.steps.current == 'token' %}
                {% blocktrans %}Please enter the token generated by your token generator.{% endblocktrans %}
              {% endif %}
            </div>
          </div>

          {% if form.non_field_errors %}
          {% trans "Please enter a correct username and password. Note that both fields may be case-sensitive." as original_error_msg %}
          {% trans "If you have forgotten your username or password, please use the ‘Trouble signing in?’ link below. Your account will be locked after 3 incorrect password attempts, and you will be sent an email with instructions on what to do." as additional_error_msg %}

            <div class="row">
              <div class="col-xs-12">
                <div class="alert alert-danger" role="alert">
                  <div class="alert-text"></div>
                  <div class="row">
                    {% if form.non_field_errors|length > 1 %}
                      <ul>
                        {% for err in form.non_field_errors %}
                            {% if err == original_error_msg %}
                                <li>{{ err }} {{ additional_error_msg }}</li>
                            {% else %}
                                <li>{{ err }}</li>
                            {% endif %}
                        {% endfor %}
                      </ul>
                    {% else %}
                        {% for err in form.non_field_errors %}
                            {% if err == original_error_msg %}
                                <div class="text-center">{{ err }} {{ additional_error_msg }}</div>
                            {% else %}
                                <div class="text-center">{{ err }}</div>
                            {% endif %}
                      {% endfor %}
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          {% endif %}

          {% if wizard.steps.current == 'auth' %}
            <input type="hidden" name="login_view-current_step" value="auth" id="id_login_view-current_step">

            <div class="form-group">
              <label for="id_auth-username">{{ form.username.label }}:</label>
              <input type="text" name="auth-username" class="form-control" autofocus="autofocus" value="{{ form.username.value|default:"" }}"maxlength="254" required="required" id="id_auth-username">
            </div>
            <div class="form-group">
              <label for="id_auth-password">{{ form.password.label }}:</label>
              <input type="password" name="auth-password" class="form-control" value="{{ form.password.value|default:"" }}" required="required" id="id_auth-password">
            </div>
          {% elif wizard.steps.current == 'token' %}
            <input type="hidden" name="login_view-current_step" value="token" id="id_login_view-current_step">
            <div class="form-group">
              <label for="id_token-otp_token">Token:</label>
              <input type="number" name="token-otp_token" class="form-control" autofocus="autofocus" value="{{ form.otp_token.value|default:"" }}" min="1" max="99999999" id="id_token-otp_token">
            </div>
          {% else %}
            {% include "two_factor/_wizard_forms.html" %}
          {% endif %}

          {# hidden submit button to enable [enter] key #}
          <div style="display: none"><input type="submit" value=""/></div>

          <div class="row">
            <div class="col-sm-12">
              {% include "two_factor/_wizard_actions.html" %}
            </div>
          </div>
      </div>

      <div class="card-footer">
          <a href="{% url 'login_assistance' %}">{% trans "Trouble signing in?" %}</a>
          <div class="clearfix"></div>
      </div>

  </form>

{% endblock %}
