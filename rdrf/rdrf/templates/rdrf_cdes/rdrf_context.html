{% extends "rdrf_cdes/base.html" %}
{% load add_attr %}
{% load static from staticfiles %}
{% load get_patient %}
{% load has_feature %}
{% load get_form_element %}
{% load is_checkbox %}
{% load is_patient_relative_widget %}
{% load is_formset_obj %}
{% load get_information_link %}

{% block extrastyle %}
    {{block.super}}
    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    <script src={% static 'js/rpc_module.js' %}></script>
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
    <script>
        $(document).ready(function(){
        $(":input").not(':input[type=checkbox], :input[type=radio], :input[type=button], :input[type=submit], :input[type=reset]').addClass("form-control");
        $("textarea").addClass("form-control");
        $("select").addClass("form-control");
        });
    </script>

{% endblock %}

{% block formlinks %}
    <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
        <span class="glyphicon glyphicon-list"></span> Modules<span class="caret"></span></a>
        <ul class="dropdown-menu" role="menu">
            <li><a href="{% url 'consent_form_view' registry patient_id context_id %}"><span class="glyphicon glyphicon-minus"></span>Consents</a></li>
            <li><a href="{% url 'patient_edit' registry patient_id context_id %}"><span class="glyphicon glyphicon-minus"></span>Demographics</a></li>
            {% if my_contexts_url %}
                <li><a href="{{my_contexts_url}}"><span class="glyphicon glyphicon-minus"></span>Other contexts for this patient</a></li>
            {% endif %}
            {% for form_link in form_links %}
                <li><a href="{{form_link.url}}"><span class="glyphicon glyphicon-minus"></span>{{form_link.text}}</a></li>
            {% endfor %}
        </ul>
    </li>
{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-md-12">
            <p><h3><span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span> {{location}}</h3></p>
            <i class="text-muted"><span class="glyphicon glyphicon-user" aria-hidden="true"></span>{{ patient_name }}</i>
        </div>
    </div>

    <br>

    <div class="row">
        <div class="col-md-10">

                {% if message %}
                    <div class="alert alert-success" role="alert">
                        {{ message }}
                    </div>
                {% endif %}

            <form class="form-horizontal" method="post" enctype="multipart/form-data">

                {% csrf_token %}

                {% if errors %}
                    <div class="alert alert-danger" role="alert">
                        Please correct errors below:<br>
                        {% for error_message in error_messages %}
                        {{ error_message }}<br>
                        {% endfor %}
                    </div>
                {% endif %}



              <p></p>

              <div class="panel panel-default">
              <div class="panel-heading">{{context_name}} Metadata</div>
              <div class="panel-body">
		{% if form.instance.context_form_group %}
		<div class="form-group">
                    <label for="Form Group" class="col-sm-3 control-label">
		      Form Group Type
		      </label>
                                <div class="col-sm-9">
                                    {{form.instance.context_form_group.name}}
                                </div>
		</div>
		{% endif %}
                   <div class="form-group">
                                <label for="created_at" class="col-sm-3 control-label">
                                    Created At
                                </label>
                                <div class="col-sm-9">
                                    {{form.instance.created_at}}
                                </div>
                   </div>

                   <div class="form-group">
                                <label for="created_at" class="col-sm-3 control-label">
                                    Last Updated
                                </label>
                                <div class="col-sm-9">
                                    {{form.instance.last_updated}}
                                </div>
                   </div>

              </div>
              </div>

              <div class="panel panel-default">
              <div class="panel-heading">Context Data</div>
              <div class="panel-body">
                   {% for field in form %}
                            <div class="form-group">
                                <label for="{{field.id_for_label}}" class="col-sm-3 control-label">
                                    {{field.label}}
                                    {% if  field.field.required %}
                                        <span class="glyphicon glyphicon-asterisk" style="color: red;" aria-hidden="true"></span>
                                    {% endif %}
                                </label>
                                <div class="col-sm-9">
				    {% if field.name != "display_name" %} 
                                          {{field|safe}}<p class="text-muted"><i>{{field.help_text}}</i></p>
				    {% else %}
                                          {{field|safe}}<p class="text-muted"><i>{{naming_info}}</i></p>
				    {% endif %}
                                    {% if field.errors %}
                                        <span class="label label-danger">{{field.errors.as_text}}</span>
                                    {% endif %}
                                </div>
                            </div>
                   {% endfor %}
              </div>
              </div>


	     {% if form_links %}
	      <div class="panel panel-default">
		<div class="panel-heading">Form Links</div>
		<div class="panel-body">
		
                   {% for form_link in form_links %}
		 
                            <div class="form-group">
                                <label for="{{form_link.text}}" class="col-sm-3 control-label">
                                    {{form_link.text}}
                                </label>
                                <div class="col-sm-9">
				  <a href="{{ form_link.link }}">Link</a>
                                </div>
                            </div>
                   {% endfor %}
              </div>
              </div>
	     {% endif %}




        </div>

        <div class="col-md-2">
            <div data-spy="affix" style="width: 150px;">
                <button type="submit" class="btn btn-success btn-block" value="Save">
                    <span class="glyphicon glyphicon-floppy-save" aria-hidden="true"></span> Save
                </button>
                <a href="" class="btn btn-danger btn-block">
                    <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Cancel
                </a>

            </div>
        </div>
        </form>
    </div>
{% endblock %}
