{% extends "rdrf_cdes/base.html" %}

{% block extrahead %}
    {{ block.super }}
    {% if age >= 18 %}
        <script>
            $(document).ready(function() {
                $('#to-parent-warning').hide();
                $('#to-parent-btn').click(function() {
                    $('#to-parent-warning').show("fast");
                });
                $('#to-parent-no').click(function() {
                    $('#to-parent-warning').hide("fast");
                });
            });
        </script>
    {% endif %}
{% endblock %}

{% block content %}
    <br/>
    
    {% if splash_screen %}
        <div class="well">
            {% autoescape off %}
                {{ splash_screen }}
            {% endautoescape %}
        </div>
    {% endif %}
    
    {% if error_msg %}
        <div class="alert alert-danger">{{error_msg}}</div>
    {% endif %}


    {% if request.user.is_authenticated %}

        {% if is_patient %}
            <div class="alert alert-success">Welcome {{request.user.first_name}}</div>
            
            <p>
                <a href="{% url 'patient_edit' registry_code patient_id context_id %}"
                    class="btn btn-warning"
                    data-toggle="popover"
                    data-content="Here you can access your personal and contact details."
                    data-placement="right">
                    <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> {% trans 'Edit your details' %}
                </a>
                {% if age >= 18 %}
                    <button id="to-parent-btn" class="btn btn-info">
                        <span class="glyphicon glyphicon-user" aria-hidden="true"></span> I am a parent
                    </button>
                    <div id="to-parent-warning" class="alert alert-danger">
                        <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                        You are about to convert your patient account in to a parent one. <strong>Are you sure?</strong>
                        <p class="pull-right">
                            <a href="{% url 'patient_to_parent' registry_code patient_id %}" class="btn btn-success"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Yes</a>
                            <button id="to-parent-no" class="btn btn-danger"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span> No</button>
                            <div class="clearfix"></div>
                        </p>
                    </div>
                {% endif %}
            </p>
            
            
            {% if not access %}
                <div class="alert alert-danger">You don't have access to this registry</div>
            {% endif %}
            
            {% if consent %}
                <ul class="list-group">
<<<<<<< HEAD
                    <li class="list-group-item">
                        Consents <a target="_blank" href="{% url 'consent_form_view' registry_code patient_id %}" class="btn btn-info btn-xs pull-right" role="button">{% trans 'Access' %}</a>
                    </li>
                {% for form in forms %}
                    <li class="list-group-item">{{form.form.name}} {% if form.readonly %}<i><font style="color: red">Readonly</font></strong></i>{% endif %}<a target="_blank" href="{{ form.link }}" class="btn btn-info btn-xs pull-right" role="button">Access</a></li>
=======
                    <a href="{% url 'consent_form_view' registry_code patient_id context_id %}"
                        data-toggle="popover"
                        data-content="<span style='color: green' class='glyphicon glyphicon-ok' aria-hidden='true'></span> Consents"
                        data-placement="bottom"
                        class="list-group-item">Consents
                    </a>
                {% for form in forms %}
                    <a href="{{ form.link }}{{context_id}}"
                        data-toggle="popover"
                        data-content="{{form.form.header|safe}}"
                        data-placement="bottom" class="list-group-item">{{form.form.name|de_camelcase}} {% if form.readonly %}<i><font style="color: red">Readonly</font></strong></i>{% endif %}
                    </a>
>>>>>>> 5caa94b... FKRP-279 Context regression: newly registered adult patient and existing adult patients can not log in, receives error
                {% endfor %}
                </ul>
            {% else %}
                <div class="alert alert-danger">
<<<<<<< HEAD
                    Please sign the consent <a href="{% url 'patient_edit' registry_code patient_id %}">here</a> to see avilable forms
=======
                    Please sign the consent <a href="{% url 'consent_form_view' registry_code patient_id context_id %}">here</a> to see avilable forms
>>>>>>> 5caa94b... FKRP-279 Context regression: newly registered adult patient and existing adult patients can not log in, receives error
                </div>
            {% endif %}
        {% elif is_admin %}
            <div class="alert alert-warning">Place for admins is <a href="{% url 'admin:index' %}">here</a></div>
        {% else %}
            <div class="alert alert-danger">Looks like you are not a patient. Please contact administrator!</div>
        {% endif %}
        
    {% else %}
        <div class="alert alert-info">Please log in to access the registry.</div>
    {% endif %}

{% endblock %}
